<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects | Technical Manager Portfolio</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 1rem; background: #f9f9f9; }
    header nav a { margin: 0 1rem; text-decoration: none; color: #004080; font-weight: bold; }
    header nav a:hover { text-decoration: underline; }
    .container { max-width: 900px; margin: auto; }
    .project { display: flex; flex-wrap: wrap; margin-bottom: 3rem; background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 0 10px rgba(0,0,0,0.05);}
    .project img { max-width: 350px; width: 100%; border-radius: 8px; margin-right: 1.5rem; object-fit: contain; }
    .project-details { flex: 1; min-width: 280px; }
    .tags, #filter-tags { margin: 1rem 0; }
    .tag {
      display: inline-block; 
      background-color: #004080; 
      color: white; 
      padding: 0.3rem 0.6rem; 
      margin: 0.2rem; 
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
      font-size: 0.9rem;
      transition: background-color 0.3s;
    }
    .tag:hover { background-color: #0066cc; }
    .tag.selected { background-color: #0080ff; }
    footer { text-align: center; margin-top: 3rem; color: #777; font-size: 0.9rem; }
  </style>
</head>
<body>
  <header>
    <h1>Technical Manager | Azure Cloud Architect</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="projects.html">Projects</a>
      <a href="techblogs.html">Tech Blogs</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main class="container">
    <section>
      <h2>Filter Projects by Tags</h2>
      <div id="filter-tags"></div>
    </section>

    <section>
      <h2>Projects</h2>
      <div id="projects-container">
        <!-- Projects will be rendered here -->
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Technical Manager. All rights reserved.</p>
  </footer>

  <script>
    // Your GitHub repo info
    const username = "vuongtrinh";
    const repo = "vuongtrinh.github.io";
    const branch = "main";

    // List of project folder names (you can keep this static or load dynamically if you prefer)
    const projectFolders = [
      "legacy-modernization-aks",
      "iot-smart-building"
      // add more project folders here
    ];

    let projectsData = []; // Will hold loaded project data
    let selectedTags = new Set();

    // Utility: fetch JSON metadata
    async function fetchMetadata(folder) {
      const url = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/projects/${folder}/metadata.json`;
      const response = await fetch(url);
      if (!response.ok) throw new Error(`Failed to load metadata for ${folder}`);
      return response.json();
    }

    // Utility: fetch README.md content and convert to HTML (basic markdown)
    async function fetchReadme(folder) {
      const url = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/projects/${folder}/README.md`;
      const response = await fetch(url);
      if (!response.ok) return "<p>No description available.</p>";
      const md = await response.text();
      return markdownToHtml(md);
    }

    // Basic markdown to HTML converter for demo (very limited)
    function markdownToHtml(md) {
      let html = md
        .replace(/^### (.*$)/gim, '<h3>$1</h3>')
        .replace(/^## (.*$)/gim, '<h2>$1</h2>')
        .replace(/^# (.*$)/gim, '<h1>$1</h1>')
        .replace(/^\> (.*$)/gim, '<blockquote>$1</blockquote>')
        .replace(/\*\*(.*)\*\*/gim, '<strong>$1</strong>')
        .replace(/\*(.*)\*/gim, '<em>$1</em>')
        .replace(/\!\[(.*?)\]\((.*?)\)/gim, "<img alt='$1' src='$2' />")
        .replace(/\[(.*?)\]\((.*?)\)/gim, "<a href='$2' target='_blank'>$1</a>")
        .replace(/\n$/gim, '<br />')
        .replace(/\n/gim, '<br />');
      return html;
    }

    // Load all projects metadata and README, then render
    async function loadProjects() {
      const container = document.getElementById('projects-container');
      container.innerHTML = "<p>Loading projects...</p>";

      projectsData = [];

      for (const folder of projectFolders) {
        try {
          const metadata = await fetchMetadata(folder);
          const readmeHtml = await fetchReadme(folder);

          projectsData.push({
            folder,
            name: metadata.name,
            imageFile: metadata.imageFile,
            tags: metadata.tags,
            descriptionHtml: readmeHtml
          });
        } catch (err) {
          console.error(err);
        }
      }

      renderTagsFilter();
      renderProjects();
    }

    // Render tags filter buttons dynamically from all tags
    function renderTagsFilter() {
      const filterTags = document.getElementById('filter-tags');
      filterTags.innerHTML = "";

      // Get all unique tags
      const allTags = [...new Set(projectsData.flatMap(p => p.tags))].sort();

      allTags.forEach(tag => {
        const tagEl = document.createElement('span');
        tagEl.className = 'tag';
        tagEl.textContent = tag;
        tagEl.onclick = () => toggleTag(tag, tagEl);
        filterTags.appendChild(tagEl);
      });
    }

    // Toggle tag selection and re-render projects
    function toggleTag(tag, element) {
      if (selectedTags.has(tag)) {
        selectedTags.delete(tag);
        element.classList.remove('selected');
      } else {
        selectedTags.add(tag);
        element.classList.add('selected');
      }
      renderProjects();
    }

    // Render projects filtered by selected tags
    function renderProjects() {
      const container = document.getElementById('projects-container');
      container.innerHTML = "";

      let filtered = projectsData;
      if (selectedTags.size > 0) {
        filtered = projectsData.filter(p =>
          [...selectedTags].every(t => p.tags.includes(t))
        );
      }

      if (filtered.length === 0) {
        container.innerHTML = "<p>No projects match the selected tags.</p>";
        return;
      }

      filtered.forEach(p => {
        const projectEl = document.createElement('div');
        projectEl.className = 'project';

        const imgSrc = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/projects/${p.folder}/${p.imageFile}`;
        projectEl.innerHTML = `
          <img src="${imgSrc}" alt="${p.name} Image" />
          <div class="project-details">
            <h3>${p.name}</h3>
            <div>${p.descriptionHtml}</div>
            <div class="tags">
              ${p.tags.map(tag => `<span class="tag">${tag}</span>`).join(' ')}
            </div>
          </div>
        `;

        container.appendChild(projectEl);
      });
    }

    loadProjects();
  </script>
</body>
</html>
